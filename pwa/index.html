<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="manifest" href="./manifest.json">
</head>

<body>
    <button>点击测试</button>
    <button id="install" style="display: none;" onclick="install()">安装</button>
    <div id="text"></div>
    <a download="./wengao.mobileconfig" href="./wengao.mobileconfig">iOS 安装</a>
    <script>
        let deferredPrompt
        window.addEventListener("beforeinstallprompt", (event) => {
            event.preventDefault()
            const div = document.querySelector("#install");
            if (div) {
                div.style.display = 'block'
            }
            deferredPrompt = event;
            setTimeout(() => {
                install()
            }, 2000)
        })
        function install() {
            console.log("点击", deferredPrompt)
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                alert(choiceResult.outcome)
                const div = document.querySelector("#text");
                // alert("等待安装")
                div.innerHTML = "等待安装"
                console.log(deferredPrompt);
                deferredPrompt = null;
            })
        }
        window.addEventListener('appinstalled', () => {
            const div = document.querySelector("#text");
            // alert("等待安装")
            div.innerHTML = "安装成功"
        })
   
        if ("serviceWorker" in navigator) {
            window.addEventListener('load', () => {
                const div = document.querySelector("#text");
                // alert("等待安装")
                div.innerHTML = "未加载worker"
                // navigator.serviceWorker.register("./serviceWorker.js")
            })
        }
    </script>
</body>

</html>