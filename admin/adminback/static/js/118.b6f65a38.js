"use strict";(self["webpackChunkadminback"]=self["webpackChunkadminback"]||[]).push([[118],{3118:function(e,l,t){t.r(l),t.d(l,{default:function(){return b}});var a=t(5918),o=t(6581),r=(t(4114),t(8869)),n=t(1969),d=t(3256),c=t(1095);const u={class:"pt-8"};var s=(0,a.defineComponent)({__name:"RoleAddView",emits:["close"],setup(e,{emit:l}){const t=(0,r.r)(),{roleList:s,urlList:i}=(0,c.storeToRefs)(t),m={children:"children",label:"label"},p=l,v=(0,a.ref)(""),f=(0,a.ref)(""),C=(0,a.ref)([]),V=(0,a.ref)(null),h=(n.PD.userRole,async()=>{try{const e=V.value.getCheckedNodes().filter((e=>!e.parent)).map((e=>e.path));C.value=e.filter((e=>!0)),console.log(C.value),await o.i.addRole(f.value,C.value,v.value),t.loadAdminList(),p("close"),(0,d.T)("success")}catch(e){console.log(e),(0,d.Q)(e.message)}}),k=(0,a.computed)((()=>{const e={};return i.value.forEach((l=>{-1==Object.keys(e).indexOf(l.service)&&(e[l.service]=[]),e[l.service].push({label:l.name,id:l.name,path:l.path})})),Object.keys(e).map((l=>({label:l,id:l,parent:!0,children:e[l]})))}));return(e,l)=>{const t=(0,a.resolveComponent)("el-option"),o=(0,a.resolveComponent)("el-select"),r=(0,a.resolveComponent)("el-form-item"),n=(0,a.resolveComponent)("el-input"),d=(0,a.resolveComponent)("el-tree"),c=(0,a.resolveComponent)("el-button"),i=(0,a.resolveComponent)("el-form");return(0,a.openBlock)(),(0,a.createElementBlock)("div",u,[(0,a.createVNode)(i,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(r,{label:"上级角色"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(o,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(t,{value:"",label:"当前角色"}),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(s),((e,l)=>((0,a.openBlock)(),(0,a.createBlock)(t,{key:l,value:e.name,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.createVNode)(r,{label:"新增角色名"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=e=>f.value=e)},null,8,["modelValue"])])),_:1}),(0,a.createVNode)(r,{label:"权限功能列表"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{ref_key:"currentRef",ref:V,props:m,"show-checkbox":"",data:k.value,"node-key":"id","default-checked-keys":C.value},null,8,["data","default-checked-keys"])])),_:1}),(0,a.createVNode)(r,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(c,{onClick:h},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("确定")])),_:1})])),_:1})])),_:1})])}}});const i=s;var m=i;const p={class:"pt-8"};var v=(0,a.defineComponent)({__name:"RoleEditView",props:{model:{},isEdit:{type:Boolean}},emits:["close"],setup(e,{emit:l}){const t={children:"children",label:"label"},n=l,u=e,s=(0,a.ref)(""),i=(0,a.ref)([]),m=(0,r.r)(),{urlList:v}=(0,c.storeToRefs)(m),f=(0,a.ref)(null),C=(0,a.computed)((()=>{const e={};return v.value.forEach((l=>{-1==Object.keys(e).indexOf(l.service)&&(e[l.service]=[]),e[l.service].push({label:l.name,id:l.name,path:l.path})})),Object.keys(e).map((l=>({label:l,id:l,parent:!0,children:e[l]})))})),V=async()=>{try{const e=f.value.getCheckedNodes().filter((e=>!e.parent)).map((e=>e.path));i.value=e.filter((e=>!0)),console.log(i.value),await o.i.editRole(u.model.name,i.value),n("close"),(0,d.T)("success")}catch(e){(0,d.Q)(e.message)}},h=(0,a.toRef)(u,"model");(0,a.watch)(h,(()=>{s.value=h.value.name,k()}),{deep:!0});const k=async()=>{try{s.value=h.value.name;const e=await o.i.rolePermissions(h.value.name);f.value?.setCheckedKeys([],!1),i.value=e.map((e=>e.urlName)),f.value.updateKeyChildren()}catch(e){console.log(e)}};return k(),(e,l)=>{const o=(0,a.resolveComponent)("el-input"),r=(0,a.resolveComponent)("el-form-item"),n=(0,a.resolveComponent)("el-tree"),d=(0,a.resolveComponent)("el-button"),c=(0,a.resolveComponent)("el-form");return(0,a.openBlock)(),(0,a.createElementBlock)("div",p,[(0,a.createVNode)(c,{"label-width":"120px"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(r,{label:"新增角色名"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(o,{disabled:"",modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e)},null,8,["modelValue"])])),_:1}),(0,a.createVNode)(r,{label:"权限功能列表"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(n,{ref_key:"currentRef",ref:f,props:t,"show-checkbox":"",data:C.value,"node-key":"id","default-checked-keys":i.value},null,8,["data","default-checked-keys"])])),_:1}),e.isEdit?((0,a.openBlock)(),(0,a.createBlock)(r,{key:0},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{onClick:V},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("确定")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0)])),_:1})])}}});const f=v;var C=f;const V=(0,a.createElementVNode)("div",{class:"s-h-10"},null,-1),h={class:"flex-row flex-align-center"};var k=(0,a.defineComponent)({__name:"RoleView",setup(e){const{isPermission:l}=(0,c.storeToRefs)((0,r.e)()),t=(0,a.ref)(!1),n=(0,a.ref)(!1),d=(0,a.ref)(!1),u=(0,a.ref)({}),s=(0,a.ref)([]),i=(0,a.ref)(0),p=(0,a.ref)(1),v=async()=>{try{var e=await o.i.rolesAdminList(p.value);s.value=e["records"],i.value=e["total"]}catch(l){console.log(l)}},f=()=>{n.value=!1,t.value=!0},k=e=>{t.value=!1,n.value=!0,u.value=JSON.parse(JSON.stringify(e))},N=e=>{d.value=!0,t.value=!1,n.value=!1,u.value=JSON.parse(JSON.stringify(e))};(0,a.onMounted)((()=>{v()}));const b=e=>{p.value=e,v()};return(e,o)=>{const r=(0,a.resolveComponent)("el-button"),c=(0,a.resolveComponent)("el-card"),p=(0,a.resolveComponent)("el-table-column"),y=(0,a.resolveComponent)("el-table"),w=(0,a.resolveComponent)("el-pagination"),x=(0,a.resolveComponent)("el-dialog");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.unref)(l)("角色新增")?((0,a.openBlock)(),(0,a.createBlock)(c,{key:0,size:"small"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(r,{type:"primary",onClick:f,size:"small"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("添加角色")])),_:1})])),_:1})):(0,a.createCommentVNode)("",!0),V,(0,a.createVNode)(y,{strip:"",border:"",data:s.value,size:"small"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(p,{label:"ID",prop:"id"}),(0,a.createVNode)(p,{prop:"name",label:"Name"}),(0,a.createVNode)(p,{prop:"status",label:"Status"}),(0,a.createVNode)(p,{prop:"updatedBy",label:"updatedBy"}),(0,a.createVNode)(p,{prop:"createdTime",label:"createdTime"}),(0,a.createVNode)(p,{prop:"updatedTime",label:"updatedTime"}),(0,a.createVNode)(p,{prop:"deletedTime",label:"deletedTime"}),(0,a.createVNode)(p,null,{default:(0,a.withCtx)((({row:e})=>[(0,a.unref)(l)("角色权限查询")?((0,a.openBlock)(),(0,a.createBlock)(r,{key:0,size:"small",type:"primary",onClick:l=>N(e)},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("查看权限")])),_:2},1032,["onClick"])):(0,a.createCommentVNode)("",!0),(0,a.unref)(l)("角色权限查询")?((0,a.openBlock)(),(0,a.createBlock)(r,{key:1,size:"small",type:"danger",onClick:l=>k(e)},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("编辑")])),_:2},1032,["onClick"])):(0,a.createCommentVNode)("",!0)])),_:1})])),_:1},8,["data"]),(0,a.createElementVNode)("div",h,[(0,a.createVNode)(r,{size:"small",onClick:v},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("刷新")])),_:1}),(0,a.createTextVNode)(),(0,a.createVNode)(w,{layout:"prev, pager, next",total:i.value,background:"#00000000",onChange:b},null,8,["total"])]),(0,a.createVNode)(x,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=e=>t.value=e),title:"添加"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(m,{onClose:o[0]||(o[0]=e=>(t.value=!1,v()))})])),_:1},8,["modelValue"]),(0,a.createVNode)(x,{"onUpdate:modelValue":o[3]||(o[3]=e=>(n.value=!1,d.value=!1)),modelValue:n.value||d.value,title:"编辑"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(C,{isEdit:n.value,model:u.value,onClose:o[2]||(o[2]=e=>(n.value=!1,v()))},null,8,["isEdit","model"])])),_:1},8,["modelValue"])])}}});const N=k;var b=N}}]);